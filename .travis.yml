sudo: required
services:
  - docker
language: php
php:
  - '7.0'
before_install:
  - pecl install mongodb
install:
  - make bootstrap
before_script:
  - ./scripts/travis-setup.sh
script:
  - ./scripts/run-tests-travis.sh
deploy:
  provider: script
  script: ./scripts/travis-deploy.sh
  on:
    branch: master
env:
  global:
  - MONGO_HOST=127.0.0.1
  - MYSQL_HOST=127.0.0.1
  - MYSQL_ROOT_PASSWORD=geheim
  - MYSQL_DATABASE=reportbook_test
  - MYSQL_USER=reportbook-test
  - MYSQL_PASSWORD=geheim

  # See port "hack" in travis-setup.sh
  - MYSQL_PORT=3307

  # DOCKER_LOGIN
  - secure: QK1b8/xezk/+Ewhghk0iZJ/a04OlCIQufinG5r8vfbvz13GNoIhCnjTpGZ+ycqgA5oXUPUrMKI4SjdW7hvQq1fRBjbEgqj2/doCJouiHug4h06ldbwZ9v73rMhBjbi/V2cbXn4PFVTSKBiuog0LUsgbHMjPAObR9BBJUUsiCBXIr0O3HhLKwF1hNj+5np8JnRMtUD5fBaUTFAlXOv2gWA5ChiXDA6J5QMD56elfk1G8XaBGSncyzbTHkzHMXxoJkvSOlj2mNlVWcC7pJnK9TeIUzaqXk34mCavmxLNwuUMzhPddDcTNyuIqWNFoxjPUTK9O+5x72HBNKB3WmRAOD+n/zIpoxcYOBRtaL/UblVQF1tmuJ21xQaB+1jVbKJB9QlYYmpmnJkX5GVplNYXrNethJLgVIs/2tJLZtpr49m64LGxRr9Cb7sHQyzLliYXxOGZH/w/yZdYAWzzFS0EM8qMzziBHshhYLiuJSezFtU7R9ETtZKISW0JDF+9jH3wo+jZpE/ewZGn4mFFNl8x7hn/25LXTWE2+ePhMMrAc2f8VC/8HKXBHCrAw3DKtopfIFDQl/V/VYFw9oAuDy1n2j4jr24/3mQXrQ5bWky4hVy8lsB3Uq3MpwNs2plFUafe6Ec0azzeUn21Bv4Rxyy2vUgOY2oHLxJrGTyoXJa8xqBJc=
  # DOCKER_PASSWORD
  - secure: F86RO2hyoyMRFUe9TKA8CMLwkQCXd+7MprkGBTjo1jvvzwDoYi1A05QbAbHaJzrAaXaYykMlOxGPJimHuQtXVBeXnRy8eiqPHyB+Mt8oP3stRYg3wAlfecU91/s/jeL5npIX1RU1vqUg1f09tnU4CVSWLo7/J/ZbfBwoH4YLlhlF76ZKSn9DpKSnPOUA/ofwSiEG0v4NgyzjkC/Bq0CJs/4ZQ9KaFXEINoHiQCGHdHCG+hyN4z0DQ+GxeRTFKEKCLXa+zWaXxwMWH5477Prf8x3GHB1UiXSChuB1yGfDr4kCQxxmbHL3SqyIq+m9ncWDOz6MBcQWTwOAtvZR39tXMiYJ62g8G6k67rFaa3PVT8zwi7Bsh327Bdkupo2uYXAC+6CXU5t4jkfW+k1Hll3Y8NdLx1TJ54bMOCLwabJ0jyAjVD55QXtqh433LYSuGE8Yksc99FD/PlLmHV1rdhK7D79gJGq2w2saR14qciRcA29kNj6b0uYePmtOdcvcMwfRiKiUXYcfBezwv41U2d4ZYdUTkaoALs9alKMNAB9MhPsy0DeBP5pSka1k7aXFXiLxH+Bs0JUcmvCsyvHwRuly1SI4fKGSX21qHk650lDPp7hpyiJ35myG8IODeLicWpvhobsQ0e91pxEZzcofzPBEGPTBp/6yXb418OoRPnA9RZQ=
  # WONDERLAND_USER
  - secure: JnN9mzJKbLPfrBk2bRILjewAWN1fgvZGtdAXIasyMY+jZmC2iWfSMXV8VW5Yo1srTmhBTFRe2kW847ZLY3CgRVqJ6syMvP4V10oD479TTJPVFyRkv/VdLl0C4RjbZvDeSYNRBTDFYxLcl66+AzCjLunckhKuSy56sVCJBjit3/fPDxUo9RhEhXEdPwN0UxNeEB7Gyyr7lJKItqjaQtr0Taa9oQQP7yA1/ZwhSF8a3i7vZL1Ni05+Un2zNWL8sKXoIHXc/BugxGO/u8XUdUAuBU+p8jVZhaE5dLQ2PmpCitwLWTOydL4WAzr/9sdm938ihFuFV3i1c3nJ6/pVpmwxGJKjpyw7YQrJS6tQ5YqV0N2Op49TjElg9qEGpimV3OyttPD6drZEC/pCymjSNhMPi96cu1JL3IMtqLjQFPlMlYsT1dAfrbXqYvk8l4VOwe04HGyjt6FAlBHUTmIW01Bhr1XYQJEvgr9YV4YjzjVMzt7+HRaScPRixm4M2x+GcJ10JTDC9D5uozTJfoVYA7FyxDpnAtQeOnFv5eAQZ7FyJNI4iX1cFbnItCMD/oNNheOO4YzdhJ+cLAazy5ntoCw1O28Cci2+v7JRZuUtcSpbSG1VO38hfYXQ8JSop1Dl5X8tQ5JuNKeeMH7jfSRcFwVVHdyJai9bjGmV9F4/4hivorE=
  # WONDERLAND_PASS
  - secure: CwfzF0vXDdrOQl/1Xwhc1s55NiV/WO23eyOA6G5WaDaWZHHWlQzSXhjH6eUJImz8v5qFUFeddQ9DXFUAuSBwhsnYYG63ZyT3IOglKdf0Vj0fjuBnoLePl5a6HAm+6+DQ9zEi6KLyVTqB81JtkzqbDPQX3Tdva8J1nDhuEbx0snjIimajHjafXMsz9qvOvXdQNfrb2qnS0QN/lQtihTYgjt/zWwpDoy3ctAq+gb1iABtZhaO8DEaqfNCjqnRAZFanf59T8kUkn83TO7raHnTwIBOVWnm412NOTbmVpRYbf+YOQOsnbCrnj84JdGeHyU352GYNLUvkEVJe+7pzjnayIzEN4m5zk+78OM536Jh//kg/H76lgDTl/PKb+YDy+J0i1+DkXlaj6WkzKGgXsfeU3/A36H/Cooi0hvVDU/D9zPzkgPFmjQ2TzafvljU31xpyEKFo+yhIU68CnQmJBlKXakqgxkgN3AHg+J3I03EhuGrXdNz1bqNV+Ox4jQSX56PCfbyVaASs2ClhV9KxG2ZPPJsFwatQ/MZDOPSvkmIvvCO5p8lsZy2AAvvGWeE7QFfWIlP0L6gvwoqTRSG8RHlNl/kGyPUNJzN2nRW1FMKh+BxrbXdel95Zy3XW/EulXYTINtTl5xBpRtIWQgQn6h323QK71ukbhrDPb43t8Wsu7Lc=
  # MONGO_PROD_USERNAME
  - secure: k5x7u5LIckkJPnsPSUUAVlNO9DHfeNGNFbxzsVZHbf/Z/45INjt9lqWCtQV2ZgFitIP65mbr6HgVFllOSfr8XCYwWawBRCFdh/Y90VarGLxbSClxs0qwtqbnqNuHbbyFcbuSeoq00CbvEHBEiQfPlXjUZKp7KF+vjbDi6R2NUkliBvQjOmquMQ1a8Yv4tCu+oSRx+9RmGzIDNSah/6d5ytoR1HWnfBrdAVeeIaD3pBggG8bf/fJw6kr5n3GqRsgdooCKsw1TVVw9yi6eBOQvUTXfmeZzK07JwPhIdQIeJkrtf4a4T9bh7lXvhP80UIQkSTYWB0f3M4S18XxI4NgP72ysYB5tqCFC5fOJBagFRGLJAWTyS0JZgMycg/ajVvjWwzhFjI0aL/LH1mp9KzkPJaBcHZurOmYnBkighDmx9xowqihMj98Cy2rm5vLvVwEwFDFG1UknqPWton/n4yb0kQN9KsurNsVDuwwKJn01OvsX/OTGHm9DK5s/uS63ylUkd8QJHbvXrlw19wWYXlheIju1Bbpc7vrNHKYhjNhKCA9sf+jXFUXUn3auFdXDCgymtEbd41raPnCScW43iYuXvZr91uzwT3sDgYnf8TphMYfj00hJVRGKIjyHaOYodW+/VRa192dJlBAO1WFz7/d/e5tjSrEL1p0xES1Psa6tdlY=
  # MONGO_PROD_PASSWORD
  - secure: BgYoebBrzRbBjdJrf10NAukVUZ6KVPP8bBepEvOciL76kfWNZ3IkkuynF8wgm/fA3wi8d1HRReQWuqutmvG53wRAxJgvaR1CXCyNUsTIvJdo2tmo1G6vVsHcugOMyvWg/QM72NQw7FWDmCgzym2KqPWziPllcHEug7vB2D8oPiqRSTIoPz/W7U2l62zAO7VFuc0FHCZoyKPqZn5DPgE5SwibqwQoyXaarSLSxoUiT74rqqwp7Tnduvm+RGmSv1YBchs79bvt4SihxxleLP49nMPQYhDGzdNGu+9shLO9HSoxYMg0pOZQU0i/8bcrl4gJrafodz+LNaZjrMm/1NZ4t0cRcHNUXKDtRrvApF/1PYmBaPh2PYLnwrL5doJYBicjGt0fbl7I78KvOEfdJgbZu/xbPG08vFkKbgJ0bZRiN4kVsXo7qnZ4AvAr///EvNwt5/RlmjOhATt+NVmRWYtGrPoMmJfW+XNh5iFkW1uOi8n2XfP5WTiWlmhs4oI+UqhHZ8Oef3No2G1TF1de2Q50TZckuvg42xbI7VbeVASHSOEcXmIIKdlSuEpDNicQWr418Z/pD+liZ/Iu1RMT/FsQ2xgyEdRUGUsDqcxhdk5EKT2muenkZ78mLWFY+GhCR8IaY4wL8RVmEfeJr73Y5J943ROSQo1tUw69aMjGNGou+t8=
  # MONGO_PROD_HOST
  - secure: FlPC5icahcc/oYpZXjSvx9FjWjeS4QfbUSLRjXd/HAKsRagB5yMeHFRHfDRMYPodD7OjYopOwhrsdfOVoYfZob+OfMD4iun0IVCwRYib2jelQYJ/t5E0EFaYBvTbQFGXq5Pf7O+PpKd2dLeyf+Jw4v/BUd4Z1klPgEljTpS1OetaxuWfLyamR7sJ/p7k2210Q5SyJcd2rQqLBwySkdDtWcwhmVN0IRcX4Q15c7oVzHaW9Jny6yfQ0CagKhnKVNUMFfTFSY6G6ch9z7914JwLPhUblI8iO76rRkWxhJ1bWacIdB6/UHCcBQi8dkex02WoB7tmX4DG4HyWs2IzxWdN3xwsWWOp37dpOpFsPHLcU5iNDF17kvakzUSfNANC8xx12YYSW5w84iC8vrYRVYPo7RuWsslTm8J0+CspzmA6NWCWzwPn2JvKN+kaFexu7qMjLmMLS2M6+btZd1qMkK+j0rUSH0dbjqV2/wtPrHELvkszaQlP+ttEhcK0zVEar92Zp7zhkAI+/h+TUi1LO+NWt31tQtPTEEDsPUR3a5iHdyeE4DBjUe2IQE16szeV9YqcMZbapykRqyTeTIqW5DC0ho85oZnMjqYsCbIcp+a4RBRiQ91iWn2gBKTL8AoEs5Xwt9nkyVrxa9m2rgqrgx6ElSN1CHT+Z1PtxoEYNEP5gjc=

notifications:
  slack:
    secure: J8NSx/Xi1kCbCp7WB67cahZDiW9y6SZTEyWhDCJKgorAjOWBavdtG6TJ61REC0TjmXb4ZEJ6oqn9Ijuew5poPf+oyKEpbnV5YQjzhnQax6D/nOvNNCm1/r6u7FhYJGDPFVYNZoBvMQ8Os6Y3wcKlxnmeEC/9tgvVZYntol/MbKRcVqforu1Liaf1s0Kxk22Gg0veVCim1wFQXTD7YC5M6VOog/ST0yijEy3NTtsvGlLA4LKHhjt7nqt5li1DIXxHpEcbai6joElQRXd58o1+6BYPyGauUy55FvN2o8HOvbJYykZJ/L4m4HZLPBm/VzDZbtUvq9PoM7x+/slQFfXy6c2qEyGjQn9SfwEUG20vemlqnGtbaWWcXB7CJ3ur1QzML9TW/sqjgTJabbtIT27g9Re6KJjMqMuncJlFPDqG4bsUxffBnfSefKYCnWE5eYclD3USkC6cc6EhitbVTfPuKtZ8WHL4pHPFhBufzq8ZuRNdaK27d86AgYJsYdQn+8gPsy3EwVkGT3at2kVQhBvdzk/JwekYOuYT1GaP61Mcc4RLE43gVn6xfuUOOuzOF+vozWUdPPmhSx5+UwE8mTbCOC61GQFQS3J2p+AJXSpJMbs8mKDx50rPE7zJXq5Mw2vc8ff2mzSv3VJ2W+rcbKuwWtY8AkgWcgY5mizcT3g9lWg=
